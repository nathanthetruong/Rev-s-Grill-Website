{% load static %} <!-- This will let us load in the CSS files in the static directory -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orders</title>

    <!-- Imports Django Button Interaction -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!--  Stylesheet for the page -->
    <link rel="stylesheet" href="{% static 'orderstyle.css' %}">


    <script src="https://kit.fontawesome.com/066f56d2e6.js" crossorigin="anonymous"></script>


</head>
<body>

    <!-- Google Translate API -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({pageLanguage: 'en'}, 'google_translate_element');
        }
    </script>
    <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <header>
        <div class="header-content" id="google_translate_element">
            <div class="logo"><img src="{% static 'rev.png' %}" alt="logo"></div>
            <a id="menu" href="{% url 'Revs-Menu-Screen' %}" style="text-decoration: none; color: black;">Menu</a>
            <a id="login" href="{% url 'Revs-Login-Screen' %}" style="text-decoration: none; color: black;">Logout</a>
            <span id="help">Help</span>
            <!-- <img src="{% static 'R.png' %}" alt="cart" class="icon" id="sidebar">           -->
            <!-- Add the count span below -->
            <div class="cart-icon-container">
                <img src="{% static 'R.png' %}" alt="cart" class="icon" id="sidebar"> 
                <span id="cart-count" class="cart-count">0</span> <!-- This will show the count -->
            </div>
        </div>
    </header>

    <div class="sidebar">
        <h2>Cart</h2>
        <div class="ordered-items">
            <p>Your Ordered Items are below.</p>
        </div>
        <div class="menu-items">
            <!-- Menu items will be dynamically added here -->
        </div>
        <!-- <div class="total-price">
            Total: $<span id="total-price">0.00</span>
        </div>     -->
        <form method="post" action="{% url 'checkout' %}">
            {% csrf_token %}
            <!-- <div class="checkout-btn-container">
                <button id="checkout-btn">Checkout</button> 
            </div> -->
            <!-- <div class="checkout-btn-container">
                <button type="submit" id="checkout-btn">Checkout</button> 
                <a href="{% url 'transaction' %}" id="checkout-btn">Checkout</a> 
                
            </div> -->
            <div class="checkout-btn-container">
                <button type="submit" id="checkout-btn">Checkout</button> 
            </div>
            
            
        </form>
             
        <button id="close-sidebar-btn"><i class="fa-solid fa-xmark"></i></button>
    </div>
    

    <!-- Second Header -->
    <section class="scrollable-section">
        <div class="header2-content">
            <div class="search-bar"> <!-- Assuming this is your search bar -->
                <input type="text" placeholder="Search here" id="searchInput">
            </div>
            <span class="item" onclick="scrollToSection('burgers_section')">Burgers</span>
            <span class="item" onclick="scrollToSection('baskets_section')">Baskets</span>
            <span class="item" onclick="scrollToSection('sandwiches_section')">Sandwiches</span>
            <span class="item" onclick="scrollToSection('shakes_section')">Shakes</span>
            <span class="item" onclick="scrollToSection('beverages_section')">Beverages</span>
            <span class="item" onclick="scrollToSection('sides_section')">Sides</span>
            
            
        </div>
        <div class="scroll-arrow"></div>
    </section>
    
    <h2> Available Menu Items to Order </h2>
    <div class="menu_sections">
        <h2>Burgers</h2>
        <div class="box-container">
            {% for button in categorized_buttons.Burgers %}
            <div class="box">
                <div class="image-section">
                    <img src="{% static 'burger.png' %}" alt="burger" class="icon">
                </div>
                <div class="details-section">
                    <div class="price">${{ button.price|floatformat:"2" }}</div>
                    <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                </div>
            </div>
            {% endfor %}
        </div>

        <div class="section" id="baskets_section">
            <h2>Baskets</h2>
            <div class="box-container">
                {% for button in categorized_buttons.Baskets %}
                <div class="box">
                    <div class="image-section">
                        <img src="{% static 'basket.jpeg' %}" alt="basket" class="icon">
                    </div>
                    <div class="details-section">
                        <div class="price">${{ button.price|floatformat:"2" }}</div>
                        <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>


        <div class="section" id="sandwiches_section">
            <h2>Sandwiches</h2>
            <div class="box-container">
                {% for button in categorized_buttons.Sandwiches %}
                <div class="box">
                    <div class="image-section">
                        <img src="{% static 'sandwich.jpeg' %}" alt="sandwich" class="icon">
                    </div>
                    <div class="details-section">
                        <div class="price">${{ button.price|floatformat:"2" }}</div>
                        <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <div class="section" id="shakes_section">
            <h2>Shakes</h2>
            <div class="box-container">
                {% for button in categorized_buttons.Shakes %}
                <div class="box">
                    <div class="image-section">
                        <img src="{% static 'shake.jpeg' %}" alt="shake" class="icon">
                    </div>
                    <div class="details-section">
                        <div class="price">${{ button.price|floatformat:"2" }}</div>
                        <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="section" id="beverages_section">
            <h2>Beverages</h2>
            <div class="box-container">
                {% for button in categorized_buttons.Beverages %}
                <div class="box">
                    <div class="image-section">
                        <img src="{% static 'beverage.jpeg' %}" alt="Beverages" class="icon">
                    </div>
                    <div class="details-section">
                        <div class="price">${{ button.price|floatformat:"2" }}</div>
                        <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="section" id="sides_section">
            <h2>Sides</h2>
            <div class="box-container">
                {% for button in categorized_buttons.Sides %}
                <div class="box">
                    <div class="image-section">
                        <img src="{% static 'sides.jpeg' %}" alt="Sides" class="icon">
                    </div>
                    <div class="details-section">
                        <div class="price">${{ button.price|floatformat:"2" }}</div>
                        <button class="menuButton" id="{{ button.description }}_button">{{ button.description }}</button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    


    <!-- Foooter Section -->
    <footer>
        <div class="footer-content">
            <div class="left-column">
                <p>Contact us: revsamericalgrill@gmail.com</p>
                <p>Follow us on social media: 
                    <a href="https://twitter.com" class="social-link" aria-label="Twitter"><i class="fab fa-twitter" style="color: #fafafa;"></i></a>
                    <a href="https://revs-8f3def7ff00e.herokuapp.com/" class="social-link" aria-label="Revs"><i class="fas fa-utensils" style="color: #ffffff;"></i></a>
                    <a href="https://instagram.com" class="social-link" aria-label="Instagram"><i class="fab fa-instagram" style="color: #fcfcfc;"></i></a>
                </p>
            </div>
            <div class="logo-column">
                <a href="orders.html">
                    <img src="{% static 'rev.png' %}" alt="Rev's American Grill Logo" class="logo">
                </a>
            </div>
            
            <div class="right-column">
                <h4>Restaurant Open Hours:</h4>
                <h5>Monday to Saturday: 11:00 AM - 10:00 PM</h5> 
                <h5>Sunday: 12:00 PM - 9:00 PM</h5>
            </div>
        </div>
        <div>
            <p >About us: Rev's American Grill is committed to providing delicious and satisfying meals in a cozy and welcoming atmosphere.</p>
            <p class="quote">"Good food is the foundation of genuine happiness." - Auguste Escoffier</p>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 Rev's American Grill. All rights reserved.</p>
        </div>
    </footer>

    <!-- Script to handle scrollable functionality -->
    <script>
        // Function to filter menu items based on search input
        document.getElementById('searchInput').addEventListener('input', function() {
            var searchText = this.value.toLowerCase();
            var menuButtons = document.querySelectorAll('.menuButton');
            
            menuButtons.forEach(function(button) {
                var buttonDescription = button.textContent.toLowerCase();
                if (buttonDescription.includes(searchText)) {
                    button.closest('.box').style.display = 'block';
                } else {
                    button.closest('.box').style.display = 'none';
                }
            });
        });
    </script>
    
    <script>
    function scrollToSection(sectionId) {
        var section = document.getElementById(sectionId);
        if (section) {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
    }
    </script>

    <!-- Script to handle sidebar interaction -->
    <script>
        $(document).ready(function() {
            // Function to open sidebar
            $('#sidebar').click(function() {
                $('.sidebar').addClass('active');
            });

            // Function to close sidebar
            $('#close-sidebar-btn').click(function() {
                $('.sidebar').removeClass('active');
            });
        });
    </script>

    <!-- Script to Round the Prices to 2 Decimal Points -->
    <script>
        document.getElementsByClassName("price").innerHTML = ""
    </script>

    <!-- Place the provided script within your existing script block -->
<script>
    $(document).ready(function() {
        // Function to handle button clicks
        $('.menuButton').click(function() {
            var description = $(this).attr('id').replace('_button', ''); // Extract description from button id
            var imageUrl = $(this).closest('.box').find('img').attr('src'); // Extract image source
            var price = $(this).closest('.details-section').find('.price').text().replace('$', ''); // Get price from the button's parent container

            // Append the menu item with price and remove button to the sidebar
            var menuItemHtml = '<div class="sidebar-item"><img src="' + imageUrl + '" alt="' + description + '" class="sidebar-icon"><span>' + description + '</span><span class="price">$' + price + '</span><button class="remove-item">Remove</button></div>';
            $('.sidebar').append(menuItemHtml);

            // Send an AJAX request to add the item to the cart
            $.ajax({
                type: "POST",
                url: "{% url 'addItem' %}", // URL for adding to cart
                data: {
                    'description': description,
                    'price': price,
                    'csrfmiddlewaretoken': '{{ csrf_token }}'
                },
                success: function(response) {
                    // Update cart count
                    $('#cart-count').text(response.cart_count);
                    // Update current price
                    $('#total-price').text(response.total_price.toFixed(2));
                },
                error: function(xhr, status, error) {
                    // Handle errors if any
                    console.error(xhr.responseText);
                }
            });
        });

        // Function to handle removing an item from the cart
        $(document).on('click', '.remove-item', function() {
            $(this).closest('.sidebar-item').remove(); // Remove the item from the sidebar
            // Optionally, you can also send an AJAX request to remove the item from the cart and update the total price
        });

        // Function to handle checkout button click
        $('#checkout-btn').click(function() {
            // Transfer items to the order summary container in transaction.html
            $('.sidebar-item').each(function() {
                var imageSrc = $(this).find('img').attr('src');
                var itemName = $(this).find('span:first').text();
                var itemPrice = parseFloat($(this).find('.price').text().replace('$', '')); // Get price from sidebar item
                var itemHtml = '<li class="order-item"><img src="' + imageSrc + '" alt="' + itemName + '" class="item-image">' + itemName + '<span>$' + itemPrice.toFixed(2) + '</span></li>';
                $('.order-items').append(itemHtml);
            });
            // Navigate to the transaction page
            window.location.href = "{% url 'transaction' %}";
        });

        // Function to clear the cart and order summary
        $('#close-sidebar-btn').click(function() {
            // Clear the cart
            $('.sidebar').empty();
            $('#total-price').text('0.00');
            // Clear the order summary
            $('.order-items').empty();
        });

        // Add the provided code snippet here
        // This part of the script handles updating the cart count when an item is added or removed
        $('.menuButton').click(function() {
            var currentCount = parseInt($('#cart-count').text());
            $('#cart-count').text(currentCount + 1);
        });

        $(document).on('click', '.remove-item', function() {
            var currentCount = parseInt($('#cart-count').text());
            $('#cart-count').text(currentCount - 1);
        });
    });
</script>

    
    
</body>
</html>
